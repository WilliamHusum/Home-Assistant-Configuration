# William Husum Home Assistant config files

## My devices

<!-- start-table -->

<table>
    <thead>
        <tr>
            <th>Switches üéö</th>
            <th>Units (#)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>TP-Link HS100</td>
            <td>2</td>
        </tr>
        <tr>
            <td>Smart Plug EU</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Sonoff Smart Zigbee Switch MINI</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Sonoff Basic 3 WiFi</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Xiaomi Aqara Single Button</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Philips Hue Dimmer switch</td>
            <td>3</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Sensors üå°Ô∏è</th>
            <th>Units (#)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Xiaomi Aqara Motion Sensor</td>
            <td>5</td>
        </tr>
        <tr>
            <td>Xiaomi Aqara Temperature Sensor</td>
            <td>2</td>
        </tr>
        <tr>
            <td>Xiaomi Aqara FP1 mmWave sensor</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Netatmo Healthy Home Coach</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Xiaomi Aqara Vibration Sensor</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Xiaomi Aqara Window/Door Sensor</td>
            <td>2</td>
        </tr>
        <tr>
            <td>Xiaomi Mi Flora Plant Sensor </td>
            <td>1</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Lights üí°</th>
            <th>Units (#)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Phillips Hue White B22 E27</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Phillips Hue Lux Extension 9W Dimmable A19 White Bulb</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Philips Hue LightStrip Plus V4 2m Base Kit</td>
            <td>2</td>
        </tr>
        <tr>
            <td>Philips Hue Adore Bathroom Mirror Lamp</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Phillips Hue White Ambiance Candle E14</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Phillips Hue White Filament Globe G125 E27</td>
            <td>2</td>
        </tr>
        <tr>
            <td>IKEA TRADFRI Bulb E14</td>
            <td>2</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Media Players üìª</th>
            <th>Units (#)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Google Nest Mini</td>
            <td>3</td>
        </tr>
        <tr>
            <td>Google Nest Hub</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Google Chromecast Audio</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Google Chromecast With Android TV</td>
            <td>1</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
   </tbody>
    <thead>
        <tr>
            <th>Hubs</th>
            <th>Units (#)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Conbee II</td>
            <td>1</td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
       </tbody>
    <thead>
        <tr>
            <th>Device Tracker üì≤</th>
            <th>Units (#)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>iPhone 12 Mini</td>
            <td>1</td>
        <tr>
        <tr>
            <td>iPhone 13 Pro</td>
            <td>1</td>
        <tr>
        <tr>
            <td>Samsung Galaxy Note20 Ultra</td>
            <td>1</td>
        <tr>
        <tr>
            <td>Samsung Galaxy Tab S8+</td>
            <td>1</td>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Vacuum üßπ</th>
            <th>Units (#)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Xiaomi Roborock S5 Max</td>
            <td>1</td>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Server/Network üåê</th>
            <th>Units (#)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Raspberry Pi 4</td>
            <td>1</td>
        <tr>
        <tr>
            <td>Synology Disk Station DS918+</td>
            <td>1</td>
        <tr>
        <tr>
            <td>Unifi Dream Router</td>
            <td>1</td>
        </tr>
        <tr>
            <td>Unifi UAP-AC-PRO</td>
            <td>1</td>
        </tr>
    </tbody>
</table>
<!-- end-table -->

# Supervisor add-ons
- [Home Assistant Google Drive Backup](https://github.com/sabeechen/hassio-google-drive-backup) version 0.109.1 by @sabeechen

# HACS plugins
 ## Frontend
 

 ## Integrations
- [HACS](https://github.com/hacs/integration)
- [nordpool](https://github.com/custom-components/nordpool)
- [Eloverblik](https://github.com/JonasPed/homeassistant-eloverblik)
- [Xiaomi Cloud Map Extractor](https://github.com/PiotrMachowski/Home-Assistant-custom-components-Xiaomi-Cloud-Map-Extractor)
- [Music Assistant](https://github.com/music-assistant/hass-music-assistant)
- [Fuelprices DK](https://github.com/J-Lindvig/Fuelprices_DK)

# Automations - Table of Content

## Bedroom
### Lower thermostat temperature, when window is opened
When we open the window in the bedroom: 
 - Save the current temperature the thermostat is set to
 - Set the thermostat temperature to low (turn it off)
When the window is closed again:
 - Retrieve the saved temperature
 - Set the thermostat temperature to the saved value

 Automations: 
 - [If window is opened, save current temperature and
    lower thermotstat temperature](https://github.com/WilliamHusum/config/blob/af480e73ccd3be2885eca848363a7d6c71b1d04c/automations.yaml#L1252-L1274)
- [When window is closed again, set thermostat to
    old value](https://github.com/WilliamHusum/config/blob/af480e73ccd3be2885eca848363a7d6c71b1d04c/automations.yaml#L1275-L1293)


### Button above bed
 - Toggle each bedlight
 - Hold to turn off all lights and set NightMode
 - Hold other button to turn off all lights and set NightMode and turn on bedside lights

 ### Switch
  - Turn on all bedroom lights
  - Turn off all bedroom lights
  - Toggle bedlights

 ### Deprecated: 
- When underwear drawer is opened between 6-8, play todays weather etc on bedroom speaker

### Alarm
15 minutes before the morning alarm goes off, our bedside lamps will slowly turn on.

Automation:
 - [Slowly turn on lights before alarm](https://github.com/WilliamHusum/config/blob/af480e73ccd3be2885eca848363a7d6c71b1d04c/automations.yaml#L981-L1004)

 Script: 
 - [Slowly turn on the lights](https://github.com/WilliamHusum/config/blob/7aabed2e42f2e65c0b2cedc6cf4ca967ddb51ef8/scripts.yaml#L186-L213)

Templates used:
- [Next alarm - 15 minutes subtracted, IsNextAlarmNow](https://github.com/WilliamHusum/config/blob/7aabed2e42f2e65c0b2cedc6cf4ca967ddb51ef8/templates.yaml#L181-L197)


## Mailbox
Mail procedure: 
 - Mail is recieved (detected by door/window sensor)
 - If someone is home, notify them and announce on speakers
 - If noone was home:
    - When the first person returns home, notify them of new mail

Automations: 
 - [If mail is delivered, set newMailToggle to true](https://github.com/WilliamHusum/config/blob/af480e73ccd3be2885eca848363a7d6c71b1d04c/automations.yaml#L1-L16)
 - [When NyPostToggle is turned on, announce on speakers](https://github.com/WilliamHusum/config/blob/7aabed2e42f2e65c0b2cedc6cf4ca967ddb51ef8/automations.yaml#L1367-L1393)
 - [When NyPostToggle is turned on, run post script](https://github.com/WilliamHusum/config/blob/7aabed2e42f2e65c0b2cedc6cf4ca967ddb51ef8/automations.yaml#L1326-L1344)
 - [When someone arrives home, run post script](https://github.com/WilliamHusum/config/blob/7aabed2e42f2e65c0b2cedc6cf4ca967ddb51ef8/automations.yaml#L1345-L1366)
 - [Mail script](https://github.com/WilliamHusum/config/blob/7aabed2e42f2e65c0b2cedc6cf4ca967ddb51ef8/scripts.yaml#L244-L275)

 ## Living Room
 - If motion is detected turn on lights
 - If FP1 stops detecting occupancy, turn off lights

 - If TV is on (smartplug power is above 60 W) turn on lights behind TV

Switch
 - Turn off living room lights
 - Turn on living room lights
 - Start moviemode (low lights)

 ## Kitchen
  - Ceiling light turned on by motion
  - Cupboard lights turned on by motion sensor under cupboards

  - Ask Google when the dishwasher should be turned on (when electricity is cheapest during the night)


## Bathroom
 - When humidity is over xx, turn on shower mode
 - Showermode = light doesn't turn off for 30 minutes
 - When motion in bedroom, turn on lights and spotify playlist
    - After 4 minutes of no motion, flash the lights, wait 30 seconds, if still no motion turn off the lights.
- Bathroom switch
    - Turn lights on
    - Turn lights off
    - Turn lights on and play G playlist
    - Turn lights on and play W playlist
    - Set LitterboxToggle

## Litterbox
- When I arrive home from work, send an actionable notification reminding me to empty the litterbox, with two buttons:
    - Snooze for an hour and resend notification
    - Done: mark in calendar that litterbox has been emptied


## Hallway
Button by the frontdoor
 - Turn off all lights
    - If the sun has set, turn on a lamp for the cats

## Vacuum
 - On weekdays at 10, if noone is home, vacuum the apartment
 - On wednesdays, go to the trashcan, to be emptied

## Lights
All lights are controlled by motion except for in the bedroom.
Between 22:30 and 6:00, the lights turn on dimmed.

## Work
- When I arrive at work, send notification to Tasker which then mutes phone
- When I leave work, send notification to Tasker which then unmutes phone
- When I turn on the car and connect to Android Auto, send notification to Grethas work PC

## Phone
- When Do Not Disturb is toggled, send notification to tablet (Tasker), which syncs DND mode to the tablet. 

## Maintenance 
- Reset toggles at midnight
- Restart Home Assistant
- Contractor mode - disable auto lights to keep them on
- Sleep mode - disable auto lights in living room to keep them off during the night
- At 6:30 turn off sleep mode (for when the alarm is not set)